/*! Twitch Chat Emotes v0.4.1, 2013-09-26, https://github.com/cletusc/Userscript--Twitch-Chat-Emotes  */
!function a(b,c,d){"use strict";function e(){return x=y=b.$j,z=x("#chat_speak"),A=x("#control_buttons"),B=x("#control_input"),z.length?(G.displayName=b.PP.display_name,G.name=b.PP.login,function a(c){var d=b.CurrentChat.user_to_emote_sets[G.name],e=50;return d?(G.emoteSets=d,h(),void 0):c>=6e4?(console.warn(I.TIMEOUT_EMOTE_SETS),void 0):(c>=1e4&&(e=1e3),setTimeout(a,e,c+e),void 0)}(0),f(),q(),r(),g(),void 0):(console.warn(I.NO_CHAT_ELEMENT),void 0)}function f(){C=x('<a class="dropdown_glyph" id="chat_emote_dropmenu_button"><span>emotes</span></a>'),C.insertBefore(z),C.hide(),z.hasClass("cap")?(B.animate({"margin-right":"175px"}),A.css("width","175px"),z.animate({"margin-right":"51px"},{complete:function(){z.css("margin-right","5px"),C.css("margin-right","5px").fadeIn()}})):z.css("float","right").animate({width:"149px"},{complete:function(){C.fadeIn()}}),D=x('<div class="dropmenu" id="chat_emote_dropmenu"></div>'),D.html(['<h4 class="draggable">Popular Emotes</h4>','<div class="scroll emotes-popular">','	<div class="tse-content emotes-container"></div>',"</div>",'<h4 class="draggable">All Emotes</h4>','<div class="scroll scroll-dark emotes-all">','	<div class="tse-content emotes-container"></div>',"</div>",'<p class="dropmenu_alt_section">','	<a class="left icon github" href="https://github.com/cletusc/Userscript--Twitch-Chat-Emotes" target="_blank" title="Visit the project page on Github"></a>','	<a class="left icon popular-emotes-location" title="Change popular emotes location"></a>','	<a class="reset" title="Reset the popularity of the emotes back to default">Reset Popularity</a>','	<a class="right icon resize-handle"></a>',"</p>"].join("\n")),D.appendTo(document.body)}function g(){function a(a){var b=a.pageX-c,d=a.pageY-e;D.width(g+b),j.height(f+d)}C.popup("click_to_close",D,{above:!0}),C.on("click",function(){D.removeClass("has_moved"),x(this).toggleClass("toggled"),h()}),D.on("clickoutside",function(){!x(this).hasClass("has_moved")&&x(this).is(":visible")&&C.click()}),D.draggable({handle:"h4.draggable",start:function(){x(this).addClass("has_moved")}});var c,e,f,g,j=D.find(".emotes-all");D.find(".resize-handle").on("mousedown",function(b){b.preventDefault(),D.addClass("has_moved"),c=b.pageX,e=b.pageY,g=D.width(),f=j.height(),x(document).on("mousemove","*",a)}),x(document).on("mouseup",function(){x(document).off("mousemove","*",a)}),D.find(".dropmenu_alt_section a.reset").on("click",function(){m(),h()}),D.find(".dropmenu_alt_section a.popular-emotes-location").on("click",function(){var a=+t("emote-popular-on-top",1);u("emote-popular-on-top",a?0:1),i(!a)}),D.on("click",".userscript_emoticon",function(){o(x(this).attr("data-emote"))}),x().TrackpadScrollEmulator||!function(a){function c(c,f){function g(){B.hasClass("horizontal")&&(D="horiz",E="scrollLeft",F="width",G="left"),B.prepend('<div class="tse-scrollbar"><div class="drag-handle"></div></div>'),w=B.find(".tse-scrollbar"),x=B.find(".drag-handle"),f.wrapContent&&C.wrap('<div class="tse-scroll-content" />'),v=B.find(".tse-scroll-content"),p(),B.on("mouseenter",m),x.on("mousedown",h),v.on("scroll",k),l()}function h(b){b.preventDefault();var c=b.pageY;"horiz"===D&&(c=b.pageX),y=c-x.offset()[G],a(document).on("mousemove",i),a(document).on("mouseup",j)}function i(a){a.preventDefault();var b=a.pageY;"horiz"===D&&(b=a.pageX);var c=b-w.offset()[G]-y,d=c/w[F](),e=d*C[F]();v[E](e)}function j(){a(document).off("mousemove",i),a(document).off("mouseup",j)}function k(){m()}function l(){var a=C[F](),b=v[E](),c=w[F](),d=c/a,e=Math.round(d*b)+2,f=Math.floor(d*(c-2))-2;a>c?("vert"===D?x.css({top:e,height:f}):x.css({left:e,width:f}),w.show()):w.hide()}function m(){l(),n()}function n(){x.addClass("visible"),"number"==typeof z&&b.clearTimeout(z),z=b.setTimeout(function(){o()},1e3)}function o(){x.removeClass("visible"),"number"==typeof z&&b.clearTimeout(z)}function p(){"vert"===D?(v.width(B.width()+q()),v.height(B.height())):(v.width(B.width()),v.height(B.height()+q()),C.height(B.height()))}function q(){var b=a('<div class="scrollbar-width-tester" style="width:50px;height:50px;overflow-y:scroll;position:absolute;top:-200px;left:-200px;"><div style="height:100px;"></div>');a("body").append(b);var c=a(b).innerWidth(),d=a("div",b).innerWidth();return b.remove(),c-d}function r(){p(),l()}function s(a,b){return b?(f[a]=b,void 0):f[a]}function t(){C.insertBefore(w),w.remove(),v.remove(),C.css({height:B.height()+"px","overflow-y":"scroll"}),u("onDestroy"),B.removeData("plugin_"+e)}function u(a){f[a]!==d&&f[a].call(A)}var v,w,x,y,z,A=c,B=a(c),C=B.find(".tse-content"),D="vert",E="scrollTop",F="height",G="top";return f=a.extend({},a.fn[e].defaults,f),g(),{option:s,destroy:t,recalculate:r}}var e="TrackpadScrollEmulator";a.fn[e]=function(b){if("string"==typeof arguments[0]){var f,g=arguments[0],h=Array.prototype.slice.call(arguments,1);return this.each(function(){if(!a.data(this,"plugin_"+e)||"function"!=typeof a.data(this,"plugin_"+e)[g])throw new Error("Method "+g+" does not exist on jQuery."+e);f=a.data(this,"plugin_"+e)[g].apply(this,h)}),f!==d?f:this}return"object"!=typeof b&&b?void 0:this.each(function(){a.data(this,"plugin_"+e)||a.data(this,"plugin_"+e,new c(this,b))})},a.fn[e].defaults={onInit:function(){},onDestroy:function(){},wrapContent:!0}}(y),D.find(".scroll.emotes-all").TrackpadScrollEmulator()}function h(){function a(a,b){var c=l(a.text),d=l(b.text),e="number"==typeof c,f="number"==typeof d;return e&&!f?-1:f&&!e?1:d>c?1:c>d?-1:0}function b(a,b){return a=a.text,b=b.text,a.toLowerCase()<b.toLowerCase()?-1:a.toLowerCase()>b.toLowerCase()?1:b>a?-1:a>b?1:0}function c(a,c){if(a.image&&!c.image)return-1;if(c.image&&!a.image)return 1;if(a.image&&c.image){if((33===a.image.emoticon_set||42===a.image.emoticon_set)&&33!==c.image.emoticon_set&&42!==c.image.emoticon_set)return-1;if((33===c.image.emoticon_set||42===c.image.emoticon_set)&&33!==a.image.emoticon_set&&42!==a.image.emoticon_set)return 1;var d=[":(",":)",":/",":D",":o",":p",":z",";)",";p","<3",">(","B)","R)","o_o"];if(d.indexOf(a.text)>=0&&d.indexOf(c.text)<0)return-1;if(d.indexOf(c.text)>=0&&d.indexOf(a.text)<0)return 1;if(a.image.emoticon_set<c.image.emoticon_set)return-1;if(a.image.emoticon_set>c.image.emoticon_set)return 1}var e=[a,c];return e.sort(b),a===e[0]?-1:1}var d,e,f=x("#chat_lines");i(+t("emote-popular-on-top",!0)),j(),d=D.find(".emotes-popular .emotes-container"),d.html(""),E.usable.sort(b),E.usable.sort(a),E.usable.forEach(function(a){p(a,d)}),d=D.find(".emotes-all .emotes-container"),d.html(""),E.usable.sort(b),E.usable.sort(c),E.usable.forEach(function(a){p(a,d)}),D.hasClass("has_moved")||(e=D.outerHeight()-D.find(".emotes-all").outerHeight(),e=f.height()-e,D.find(".emotes-all").height(e),D.width(x("#speak").outerWidth()-12),D.offset(f.offset()))}function i(a){var b=D.find(".emotes-popular"),c=D.find(".emotes-popular").prev(),d=D.find(".emotes-all"),e=D.find(".popular-emotes-location");a?(c.insertBefore(d.prev()),b.insertBefore(d.prev()),e.removeClass("popular-on-bottom")):(b.insertAfter(d),c.insertAfter(d),e.addClass("popular-on-bottom"))}function j(){E.usable=[],E.raw.forEach(function(a){a.text||(a.text=decodeURI(a.regex.source).replace("&gt\\;",">").replace("&lt\\;","<").replace(/\(\?![^)]*\)/g,"").replace(/\(([^|])*\|?[^)]*\)/g,"$1").replace(/\[([^|])*\|?[^\]]*\]/g,"$1").replace(/[^\\]\?/g,"").replace(/^\\b|\\b$/g,"").replace(/\\/g,""));var b=!1;a.images.forEach(function(c){null===c.emoticon_set&&(b=c),G.emoteSets.indexOf(c.emoticon_set)>=0&&(a.image=c)}),a.image||b&&(a.image=b),E.usable.push(a)})}function k(a,b){n(),F[a]===d&&(F[a]=0),"number"==typeof b&&b>=0?F[a]=b:F[a]++,u("emote-popularity-tracking",JSON.stringify(F))}function l(a){return n(),"number"==typeof F[a]&&F[a]>=0?F[a]:!1}function m(){v("emote-popularity-tracking"),F=!1,n()}function n(){F||(F=JSON.parse(t("emote-popularity-tracking","{}")),k("BibleThump",0),k("DansGame",0),k("FailFish",0),k("Kappa",0),k("Kreygasm",0),k("SwiftRage",0))}function o(a){k(a);var b=document.querySelector("#chat_text_input"),c=b.selectionStart+a.length,d=b.value,e=d.substring(0,b.selectionStart),f=d.substring(b.selectionEnd,d.length);""!==e&&" "!==e.substr(-1)&&(a=" "+a),a+=" ",b.value=e+a+f,b.focus(),c=b.selectionStart+a.length,b.setSelectionRange(c,c),D.hasClass("has_moved")?h():C.click()}function p(a,b){if(a&&a.image&&b.length){var c=x('<div class="userscript_emoticon"></div>');c.html(a.image.html),c.attr("data-emote",a.text),a.image.emoticon_set&&c.attr("data-emote-set",a.image.emoticon_set),c.attr("title",a.text),b.append(c)}}function q(){var a={dropmenuButton:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAAQCAYAAAAbBi9cAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAKUSURBVDhPfZTNi1JRGMZvMIsWUZts5SIXFYK0CME/IGghxVC7WUoU1NBixI+mRSD4MQzmxziKO3XUBhRmUGZKdBG40XEGU6d0GFGZcT4qxW1hi7fzvNwZqKwDD5z7vs/vueeee+6VMJxO5wUhhdvtfuHz+T4tLS2NhegfGsMDLxiwHIIhLi57PJ75VCr1Y39/n4bDIY1Go4lCDx54wYCVYzjoVjQa/dxutyfCkwSvYJpgOSQf708tuBa1yWRy/L+V/Cl4wYBFhhTxfLhum/esiiJ1u12KRCJksVhofX2dTk5OzkHMUUMPHnjB2F55VpEhPde/Lbx8FqBEIkHpdJoMBgNptVrS6XRUqVTOg7a3t2lmZob0ej2p1Wr2ggGLDOnJ3QSZH4coHo/TysoKhygUCtJoNFQsFmkwGLAwR7hSqSSVSsVeMGCRIT29F6fXJi8Xy+Uymc1mmp6eJofDQfV6nU5PT1mY2+127uHxSqUSh4FFhhQLvrvtcrm+YpkHBwdUrVZpa2uLarUadTodOjw8ZGGOGnrwwAsGLDLw1i4uLrzRYeOOj49pb2+Pdnd3qdVq8StGAIQ5ao1Ggz3wggGLDD4C4izcEcWfR0dHbMrlcrSxscGbjVAIK8lms7S5ucmB/X6fXz9YDsEQFzdjsVit2Wzyqc1kMrwfVquVjEYjzc3NkclkIpvNRmtra+yBVzAfBXtDjuGgS8FgcFbc8QvuhjNSKBQoFAqR6LFEn/L5PPfggXd5eXkWrBzDQdC1QCBgFoeut7Ozw/tyBp2FQzhPwtOFFwzY34Yo4A9wRXzdD8LhcE48wncE9no9Fuaoid574bkPLxgZ/3uI5pTQVfFlP/L7/Wmhb7JSXq/3IXrwyHZ5SNIvGCnqyh+J7+gAAAAASUVORK5CYII=",resizeHandle:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABGdBTUEAALGPC/xhBQAAAAlwSFlzAAAOwgAADsIBFShKgAAAABp0RVh0U29mdHdhcmUAUGFpbnQuTkVUIHYzLjUuMTAw9HKhAAAAX0lEQVQ4T6WPUQ7AIAhDPfpuzuyHxpGK7SR5IVYeCS0irqChAw0daOhAQwcaijyAfShARv1aMOWOfcJHBnmgIsvo8glMRkkLtnLneEIpg3U4c5LRtycoMqpcMIaLd7QXl2chH51cR7QAAAAASUVORK5CYII=",arrows:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAgCAYAAAAbifjMAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAClSURBVEhL7ZRBDoAgEAN9uj9fKaFkl61EiN5sMgcLnYMHDjObcTbUWUWWDQyZW4ksC37MSEkqCmrMJEn4KMzGTJCsjpku2RkzVbI7Zk4KFGPUnSpQ4HAMunQ3FY1f8IIAYOBRd74TYDBGSlLR+AWLAhwoxqg7/T3YTX8PdiTYhH+wIqlj4AVPJX0M/JjMJGEMwodDSdIYpMLhJXIMZOnA8HZsZscFnEfNs2qCgdQAAAAASUVORK5CYII=",github:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAALiIAAC4iAari3ZIAAAAadEVYdFNvZnR3YXJlAFBhaW50Lk5FVCB2My41LjEwMPRyoQAAAWpJREFUOE+F0ssrRGEYx/EZBhs2ssHCrCasFf4DFiKyERuytRMZESl3WxsbK0s2FlKKxkIJOyRpEgtyv19yfH/H87qm86tPvee9POd5z0zodzzPK8I4NnFuNjCKmG37GxbTMYEXrKMb9aYHKviMYaTZsY8wocPzOEENbOUrzIWhYmeYQ8SW/MUxnKICekMhNJ+FTBvraiOohK414A7HoNbqUAvlCcd4NRprj1KFBmhPVAWGsAXXYlCqkYJt9KnAGvrhxkFJWOe66ooGaq8REdwgKBdQBy1IqsARmqArqFhQktC5VhxosIpBa2sKQZm0vfrPLGmg++uD5KAYKvhflpGNVOwjrgIFeEAbZhFFGXbhkkAJwvZ2tX+HPD1rohdXtnAI/axvcPE/nO0thT52p39Y4UEtzeAS7SjHI1zUYQaacY1p+AU/w4SKxHEPfRP9A1003sEt9IKfh7+HxXx0YRF7ZgEdyLVtllDoHUPsDkVplXakAAAAAElFTkSuQmCC"},b=["#chat_emote_dropmenu_button span {",'	background: url("'+a.dropmenuButton+'") no-repeat 50%;',"	cursor: pointer;","}","#chat_emote_dropmenu_button.toggled {","	box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.15), 0 1px 0 rgba(255, 255, 255, 0.65);","	-moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.15), 0 1px 0 rgba(255, 255, 255, 0.65);","	-webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.15), 0 1px 0 rgba(255, 255, 255, 0.65);","	border-top: 1px solid rgba(0, 0, 0, 0.35);","	border-left: 1px solid rgba(0, 0, 0, 0.3);","	border-right: 1px solid rgba(0, 0, 0, 0.3);","	border-bottom: 1px solid rgba(0, 0, 0, 0.3);",'	background: url("../images/xarth/dropdown_arrow.png") no-repeat right center, -webkit-gradient(linear, left top, left bottom, from(#ddd), to(#bbb));','	background: url("../images/xarth/dropdown_arrow.png") no-repeat right center, -moz-linear-gradient(top, #ddd, #bbb);','	background: url("../images/xarth/dropdown_arrow.png") no-repeat right center, -o-linear-gradient(top, #ddd, #bbb);','	background: url("../images/xarth/dropdown_arrow.png") no-repeat right center, linear-gradient(top, #ddd, #bbb);',"	background-color: #ccc;","}","#chat_emote_dropmenu {","	padding: 5px;","}","#chat_emote_dropmenu {","	background-color: #202020;","}","#chat_emote_dropmenu .tse-scroll-content {","	right: -17px;","}","#chat_emote_dropmenu h4 {","	text-align: center;","	padding: 3px;","}","#chat_emote_dropmenu .emotes-popular {","	height: 38px;","}","#chat_emote_dropmenu h4.draggable:hover {","	background-color: rgba(255, 255, 255, 0.1);","	border-radius: 5px;","	cursor: move;","}","#chat_emote_dropmenu .userscript_emoticon {","	display: inline-block;","	padding: 2px;","	margin: 1px;","	cursor: pointer;","	border-radius: 5px;","	text-align: center;","	width: 32px;","}","#chat_emote_dropmenu .userscript_emoticon .emoticon {","	max-width: 32px;","	margin: 0 !important;","	height: 32px;","	background-size: contain;","}","#chat_emote_dropmenu .userscript_emoticon:hover {","	background-color: rgba(255, 255, 255, 0.1);","}","#chat_emote_dropmenu .dropmenu_alt_section a {","	cursor: pointer;","}","#chat_emote_dropmenu .dropmenu_alt_section .left {","	float: left;","	margin-right: 5px;","}","#chat_emote_dropmenu .dropmenu_alt_section .right {","	float: right;","	margin-left: 5px;","}","#chat_emote_dropmenu .dropmenu_alt_section a.icon {","	height: 16px;","	width: 16px;","	opacity: 0.5;","}","#chat_emote_dropmenu .dropmenu_alt_section a.icon:hover {","	opacity: 1.0;","}","#chat_emote_dropmenu .dropmenu_alt_section a.github {",'	background: url("'+a.github+'") no-repeat 50%;',"}","#chat_emote_dropmenu .dropmenu_alt_section a.popular-emotes-location {",'	background: url("'+a.arrows+'") no-repeat 50% top;',"}","#chat_emote_dropmenu .dropmenu_alt_section a.popular-emotes-location.popular-on-bottom {","	background-position: bottom;","}","#chat_emote_dropmenu .dropmenu_alt_section a.resize-handle {",'	background: url("'+a.resizeHandle+'") no-repeat 50%;',"	cursor: nwse-resize;","}"],c={DansGame:"http://i.imgur.com/qonn0aV.png"};for(var d in c)c.hasOwnProperty(d)&&b.push('#chat_emote_dropmenu .userscript_emoticon[data-emote="'+d+'"] .emoticon { background-image: url("'+c[d]+'") !important; }');s(b.join("\n"))}function r(){var a=[],b={};E.raw.forEach(function(a){a.images.forEach(function(a){null===a.emoticon_set||b[a.emoticon_set]||(b[a.emoticon_set]='#chat_emote_dropmenu .userscript_emoticon[data-emote-set="'+a.emoticon_set+'"] { background-color: hsla('+90*a.emoticon_set+", 100%, 50%, 0.1) !important; }",b[a.emoticon_set]+='#chat_emote_dropmenu .userscript_emoticon[data-emote-set="'+a.emoticon_set+'"]:hover { background-color: hsla('+90*a.emoticon_set+", 100%, 50%, 0.2) !important; }")})});for(var c in b)b.hasOwnProperty(c)&&a.push(b[c]);s(a.join("\n"))}function s(a){var b=document.createElement("style");b.textContent=a,document.querySelector("head").appendChild(b)}function t(a,b){var c=localStorage.getItem(a);return null===c&&"undefined"!=typeof b?b:c}function u(a,b){localStorage.setItem(a,b)}function v(a){localStorage.removeItem(a)}if(c){var w=document.createElement("script");return w.textContent="("+a+")(window, false)",document.body.appendChild(w),document.body.removeChild(w),void 0}var x,y,z,A,B,C,D,E={usable:[],get raw(){return b.CurrentChat.emoticons}},F=!1,G={displayName:"",emoteSets:[],name:""},H="Twitch Chat Emotes",I={ALREADY_RUNNING:"There is already an instance of this script running, cancelling this instance.",CHAT_NOT_LOADED:"Chat hasn't loaded yet.",NO_CHAT_ELEMENT:"There is no chat element on the page, unable to continue.",NOT_LOGGED_IN:"You are not logged in, please log in first.",OBJECTS_NOT_LOADED:"Needed objects haven't loaded yet.",TIMEOUT_EMOTE_SETS:"Took too long to find turbo/subscription emote sets, using default. Refresh to try again.",TIMEOUT_SCRIPT_LOAD:"Script took too long to load. Refresh to try again."};for(var J in I)I.hasOwnProperty(J)&&(I[J]="["+H+"]: "+I[J]);!function K(a){var c=b.CurrentChat?b.CurrentChat.last_sender!==!1:!1,f=50,g=b.Twitch&&b.Twitch.user.isLoggedIn(),h=b.PP!==d&&b.Twitch!==d&&b.CurrentChat!==d&&b.CurrentChat.emoticons!==d&&b.CurrentChat.emoticons.length&&b.$j!==d;if(document.querySelector("#chat_emote_dropmenu_button"))return console.warn(I.ALREADY_RUNNING),void 0;if(!h||!g||!c){if(a>=6e4)return console.error(I.TIMEOUT_SCRIPT_LOAD),void 0;if(a>=1e4){if(f=1e3,!g)return console.error(I.NOT_LOGGED_IN),void 0;h||console.warn(I.OBJECTS_NOT_LOADED),c||console.warn(I.CHAT_NOT_LOADED)}return setTimeout(K,f,a+f),void 0}e()}(0)}(this.unsafeWindow||window,window.chrome?!0:!1);